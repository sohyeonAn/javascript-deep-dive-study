## 스코프
### 스코프란?
- 모든 **식별자**(변수 이름, 함수 이름, 클래스 이름 등)는 자신이 선언된 **위치**에 의해 다른 코드가 식별자 자신을 참조할 수 있는 유효 범위가 결정되는데 이 식별자가 유효한 범위를 **스코프** 라고 한다.
```js
var x = 'global';// 코드의 가장 바깥 영역에 선언된 변수는 어디서든 참조할 수 있다.

function foo() {
  var x = 'local'; // 함수 내부에서 선언된 변수는 함수 내부에서만 참조할 수 있다.
  console.log(x); // local
}

foo();
console.log(x); // global
```
- 자바스크립트 엔진은 이름이 같은 변수가 있으면 어떤 변수를 참조해야 할 지 결정해야 하고 이를 **식별자 결정**이라 말한다.
- 식별자 결정 과정에서 자바스크립트 엔진은 스코프를 통해 어떤 변수를 참조해야 할지 결정한다. 따라서 **식별자를 검색할 때 사용하는 규칙**을 스코프라고 할 수 있다.
- 위 예제에서 두 개의 `x`변수는 식별자 이름이 동일하지만 자신이 유효한 범위, 즉 스코프가 다른 별개의 변수다.
- 스코프 내에서 식별자는 유일해야 하지만 다른 스코프에는 같은 이름의 식별자를 사용할 수 있다.

<br>

**변수의 중복 선언**
```js
function foo() {
  var x = 1;
  // 아래 변수 선언문은 자바스크립트 엔진에 의해 var 키워드가 없는 것처럼 동작.
  // x = 2;
  var x = 2;
  console.log(x); // 2
}
foo();
```
```js
function bar() {
  let x = 1;
  let x = 2; // SyntaxError: x가 이미 선언되었음.
}
bar();
```
-  `var` 키워드로 선언된 변수는 **같은 스코프 내에서 중복 선언을 허용한다.**
- `let, const`로 선언된 변수는 **같은 스코프 내에서 중복 선언을 허용하지 않는다.**

<br>

### 스코프의 종류
- 코드는 전역(global)과 지역(local)로 구분한다.
- 변수는 **자신이 선위된 위치**에 의해 스코프가 결정된다.

구분 | 설명 | 스코프 | 변수
:--:|--|:--:|:--:
전역 | 코드의 가장 바깥 영역 | 전역 스코프 | 전역 변수
지역 | 함수 몸체 내부 | 지역 스코프 | 지역 변수

```js
// 전역 변수
// x, y는 어디서든 참조할 수 있다.
var x = 'global x';
var y = 'global y';

function outer() {
  var z = 'outer\'s local z'

  console.log(x); // global x 
  console.log(y); // global y
  console.log(z); // outer's local z

  function inner() {
    var x = 'inner\'s local x';

    console.log(x); // inner's local x
    console.log(y); // global y
    console.log(z); // outer's local z    
  }

  inner();
}

outer();

console.log(x); // global x
console.log(z); // ReferenceError: z는 정의되지 않았다.
```
#### 전역과 전역 스코프
- 전역 변수는 어디서든 참조할 수 있다.


#### 지역과 지역 스코프
- 지역 변수는 자신의 지역 스코프와 하위 지역 스코프에서 유효하다.
- 위 예제에서 `inner`함수 내부에서 `x`변수를 참조하면 전역 변수 `x`를 참조하는 것이 아니라 `inner`함수 내부에서 선언된 `x`변수를 참조한다.

<br>

### 스코프 체인
- 중첩 함수의 지역 스코프는 중첩 함수를 포함하는 외부 함수의 지역 스코프와 **계층적 구조**를 갖는다.
- 스코프가 계층적으로 연결된 것을 **스코프 체인**이라 한다.
- 변수를 참조할 때 자바스크립트 엔진은 스코프 체인을 통해 **변수를 참조하는 코드의 스코프에서 시작하여 상위 스코프 방향으로 이동하며 선언된 변수를 검색** 한다.


#### 스코프 체인에 의한 변수 검색
- 상위 스코프에서 유효한 변수는 하위 스코프에서 자유롭게 참조할 수 있지만 하위 스코프에서 유효한 변수를 상위 스코프에서 참조할 수 없다.
```js
var x = 'global x';
var y = 'global y';

function outer() {
  var z = 'outer\'s local z'

  function inner() {
    var x = 'inner\'s local x';

    console.log(x); 
    // x 변수를 참조하는 코드의 스코프인 inner 함수의 지역 스코프에서
    // x 변수가 선언되었는지 검색하고 선언된 변수가 존재하면 검색을 종료한다.
    console.log(y); 
    // y 변수를 참조하는 inner 함수의 지역 스코프에 y 변수가 선언되지 않았으므로 
    // 상위 스코프인 outer 함수의 지역 스코프로 이동한다.
    // outer 함수의 지역 스코프에도 y 변수가 선언되지 않았으므로
    // 전역 스코프로 이동한다. 전역 스코프에 y 변수가 존재한다.
    console.log(z); // outer's local z    
  }

  inner();
}

outer();
```
#### 스코프 체인에 의한 함수 검색
- 함수도 식별자에 해당하기 때문에 스코프를 갖는다.
- 일반 변수의 스코프와 같이 동작한다.
```js
function foo() {
  console.log('global function foo');
}

function bar() {
  function foo() {
    console.log('local function foo');
  }

  foo(); // local function foo
}
bar();
```
<br>

### 함수 레벨 스코프
- 지역 스코프는 **코드 블록이 아닌 함수**에 의해서만 생성된다.
- **블록 레벨 스코프**: 함수 몸체만이 아니라 모든 코드 블록(if, for, while, tyr\catch 등)을 스코프로 인정함.
- **함수 레벨 스코프**: 오로지 함수의 코드 블록(함수 몸체)만을 지역 스코프로 인정함.
- `var` 키워드로 선언된 변수는 **함수 레벨 스코프**를 가지고 `let, const`로 선언된 변수는 **블록 레벨 스코프**를 가진다. (자세한 내용은 15장...)
```js
var x = 1;

if (true) {
  // var 키워드로 선언된 변수는 함수 몸체만을 지역 스코프로 인정한다.
  // 따라서 이미 선언된 전역 변수 x가 있으므로 x변수는 중복선언된 후 재할당된다.
  var x = 10;
}

console.log(x); // 10
```
```js
var i = 10;

// var로 선언한 for문 내의 i는 전역 변수다.
// 이미 선언된 전역 변수 i가 있으므로 중복 선언된다.
for(var i = 0; i < 5; i++){
  console.log(i); // 0 1 2 3 4 
}

console.log(i); // 5
```
<br>

### 렉시컬 스코프
```js
var x = 1;

function foo() {
  var x = 10;
  bar();
}

function bar() {
  console.log(x);
}

foo(); // 1
bar(); // 1, 
// bar는 전역에서 정의된 함수이므로 전역 스코프를 상위 스코프로 결정한다.
```
- **동적스코프**
  - 함수를 **어디서 호출**했는지에 따라 상위 스코프를 결정한다.
  - 함수가 호출되는 시점에 동적으로 상위 스코프를 결정한다.
- **렉시컬 스코프(정적 스코프)**
  - 함수를 **어디서 정의**했는지에 따라 상위 스코프를 결정한다.
  - 함수의 상위 스코프는 언제나 자신이 정의된 스코프다.
  - 함수 정의가 실행되어 생성된 함수 객체는 상위 스코프를 **기억**한다.
  - 호출된 위치는 상위 스코프 결정에 어떠한 영향도 주지 않는다.
- 자바스크립트는 **렉시컬 스코프**를 따른다.
